<!DOCTYPE html>
<html>
  <head>
    <title>Yahoo Fantasy Viz</title>
  	<script type="text/javascript" src="d3.min.js"></script>
    <script type="text/javascript" src="jquery-2.1.0.min.js"></script>
    
    <link type="text/css" rel="stylesheet" href="style.css"/>
  
  </head>
  <body>
    <div id="selector"></div>
    <div id="graph"></div>
  	<script type="text/javascript">

  		// Team stats data set
  		var stats = [
  			{"FTs": "110/132", "name": "Great Scott!", "Ast": 117.0, "Stl": 39.0, "Rbs": 212.0, "3pt": 33.0, "FGs": "187/399", "FTP": 0.833, "Blk": 21.0, "TOs": 78.0, "FGP": 0.469, "Pts": 517.0},
  			{"FTs": "87/118", "name": "From Last to First", "Ast": 107.0, "Stl": 30.0, "Rbs": 215.0, "3pt": 31.0, "FGs": "177/419", "FTP": 0.737, "Blk": 30.0, "TOs": 88.0, "FGP": 0.422, "Pts": 472.0},
  			{"FTs": "119/151", "name": "Large McBigHuge", "Ast": 117.0, "Stl": 46.0, "Rbs": 176.0, "3pt": 22.0, "FGs": "178/393", "FTP": 0.788, "Blk": 18.0, "TOs": 88.0, "FGP": 0.453, "Pts": 497.0},
  			{"FTs": "115/164", "name": "K-Mac", "Ast": 156.0, "Stl": 30.0, "Rbs": 192.0, "3pt": 36.0, "FGs": "185/384", "FTP": 0.701, "Blk": 32.0, "TOs": 82.0, "FGP": 0.482, "Pts": 521.0},
  			{"FTs": "136/201", "name": "ZNS", "Ast": 152.0, "Stl": 74.0, "Rbs": 300.0, "3pt": 36.0, "FGs": "237/529", "FTP": 0.677, "Blk": 31.0, "TOs": 102.0, "FGP": 0.448, "Pts": 646.0},
  			{"FTs": "121/155", "name": "Paul's Team", "Ast": 79.0, "Stl": 38.0, "Rbs": 207.0, "3pt": 22.0, "FGs": "210/446", "FTP": 0.781, "Blk": 27.0, "TOs": 81.0, "FGP": 0.471, "Pts": 563.0},
  			{"FTs": "94/119", "name": "Carter", "Ast": 116.0, "Stl": 28.0, "Rbs": 202.0, "3pt": 40.0, "FGs": "178/387", "FTP": 0.79, "Blk": 18.0, "TOs": 95.0, "FGP": 0.46, "Pts": 490.0},
  			{"FTs": "105/128", "name": "Starvis Flocka Flame", "Ast": 113.0, "Stl": 29.0, "Rbs": 181.0, "3pt": 32.0, "FGs": "163/407", "FTP": 0.82, "Blk": 20.0, "TOs": 72.0, "FGP": 0.4, "Pts": 463.0}];

      var margin = {top: 50, right: 20, bottom: 40, left: 250},
          width = 800 - margin.left - margin.right,
          height = 600 - margin.top - margin.bottom,
          barPad = 3;

      // Create category list and dropdown menu
      // In future, use league resource and settings
      var categories = [["FGP", "Field Goal %"],
                        ["FTP", "Free Throw %"],
                        ["3pt", "Three Point FGs"],
                        ["Pts", "Points"],
                        ["Ast", "Assists"],
                        ["Rbs", "Rebounds"],
                        ["Stl", "Steals"],
                        ["Blk", "Blocks"],
                        ["TOs", "Turnovers"]];

      d3.select("#selector").append("select")
        .attr("id", "selectCat")
        .selectAll("option")
        .data(categories)
        .enter()
        .append("option")
        .attr("value", function(d) { return d[0]; })
        .text( function(d) {return d[1]; });
      
      var statCat = $("#selectCat").val();
      console.log(statCat)

      // Create x- and y-scale
      var xScale = d3.scale.linear()
        .domain([0, d3.max(stats, function(d) { return d[statCat]; })])
        .range([0, width]);

      var yScale = d3.scale.ordinal()
        .domain(d3.range(stats.length))
        .rangeRoundBands([0, height], 0.05);

      // Create SVG space
  		var svgContainer = d3.select("#graph").append("svg")
  			.attr("width", width + margin.left + margin.right)
  			.attr("height", height + margin.top + margin.bottom)
  			.style("border","1px solid black")
        .append("g")
        .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

  		// create bars function then call to draw with 0ms transition
      var bars = svgContainer.selectAll("g.team")
          .data(stats)
          .enter()
          .append("g")
          .attr("class", "team")
          .attr("transform", function(d, i) {
            return "translate(0," + yScale(i) + ")";
          });

      function drawBars(durationInt) {
        bars.append("rect")
          .transition()
          .duration(durationInt)
          .attr({
            width: function(d) { return xScale(d[statCat]); },
            height: yScale.rangeBand()
          })
      };

      drawBars(0);

      // team names
      svgContainer.append("g")
        .attr("id", "teamLabels")
        .selectAll("text")
        .data(stats)
        .enter()
        .append("text")
        .text(function(d) { return d.name; })
        .attr({
          x: function(d, i) {return xScale(i); },
          y: height + margin.bottom / 2,
          "font-family": "sans-serif",
          "font-size": "8px"
        })
			/*
      // labels						
		  svgContainer.append("g")
        .attr("class", "statLabels")
        .selectAll("text")
				.data(stats)
				.enter()
				.append("text")
				.text(function(d) { return d[statCat]; })
				.attr({
					x: function(d, i) {return xScale(i) + xScale.rangeBand() / 2;},
					y: function(d) {return height - yScale(d[statCat]) + 20;},
					"text-anchor": "middle",
					"font-family": "sans-serif",
					fill: "white"
				});
*/
      d3.select("select")
        .on("change", function() {
            statCat = $("#selectCat").val();

            xScale.domain([0, d3.max(stats, function(d) { return d[statCat]; })]);

            drawBars(500);
            
            svgContainer.select(".statLabels")
            .selectAll("text")
            .text(function(d) { return d[statCat]; })
            .transition()
            .duration(500)
            .attr({
              x: function(d, i) {return xScale(i) + xScale.rangeBand() / 2;},
              y: function(d) {return height - yScale(d[statCat]) + 20;},
            });

        });
/*
        // yAxis
        svgContainer.append("g")
			.attr("class", "axis")
			.call(yAxis);
      */
								
  	</script>

  </body>
</html>